import{o as q,E as H,T as N,G as P,f as L,A as Q,B as $,z as J,H as W,a as X,y as b,g as w,K as Y,L as Z,_ as R,r as g,M as ee,h as l,i as n,j as i,w as c,k as u,l as T,t as _,N as x,O as B,Q as te,q as z,P as se,R as oe,S as le}from"../index59036.js";const ae={setup(){q(()=>{d.value=!0,e.value={first:0,rows:C.value.rows,sortField:null,sortOrder:null,filters:y.value},H.register("myfilter",(t,f)=>t===f),p(),E(),K(),I(),O()});const m=N(),a=P(),v=L(()=>m.status),o=Q(),A=$(),M=J(),S=W(),r=L(()=>m.responseBundle),h=X(),C=b(),F=b(),y=b({global:{value:null,matchMode:"like"}}),d=b(!0),e=b(),s=b(0);function p(){var f;d.value=!0;let t=new Map;(f=y.value.global)!=null&&f.value&&t.set("it_title_like",y.value.global.value),t.set("page",e.value.page+1),t.set("per_page",e.value.rows),setTimeout(()=>{k(t)},Math.random()*1e3+250)}const k=async function(t){await m.fetchAllBundles(t).then(()=>{d.value=!1}).catch(f=>{d.value=!1,w(h,f)})},V=t=>{e.value=t,p()},D=t=>{e.value=t,p()},G=()=>{e.value.page=0,e.value.filters=y.value,p()},j=function(t){a.setDetailType("bundle",!1,"Dettaglio pacchetto",t.id),a.updateSidebar(!0)},U=function(t){return t!=null&&t.cluster?t.cluster:""},E=async function(){let t=new Map;await o.fetchAllCategories(t).then(()=>{d.value=!1}).catch(f=>{d.value=!1,w(h,f)})},I=async function(){let t=new Map;await A.fetchAllGuides(t).then(()=>{d.value=!1}).catch(f=>{d.value=!1,w(h,f)})},K=async function(){await M.fetchAllTags().then(()=>{d.value=!1}).catch(t=>{d.value=!1,w(h,t)})},O=async function(){await S.fetchAllLanguages().catch(t=>{w(h,t)})};return{dt:C,responseBundles:r,filters:y,loading:d,totalRecords:s,lazyParams:e,currentBundle:F,status:v,onPage:V,onSort:D,onFilter:G,showSidebar:j,loadLazyData:p,getRowClass:U,prettyStatus:Y,formatDataFromUnixTimestamps:Z}},components:{}};const ne={class:"bundle-table"},ie={class:"flex justify-content-between align-items-center"},re={class:"p-input-icon-left w-full mr-3 py-2"},ce=u("i",{class:"pi pi-search"},null,-1),ue={class:"flex flex-column line-height-3"},de={class:"flex flex-column line-height-3"},fe={class:"flex align-items-center line-height-3"},_e=["alt"],he=u("div",{class:"text-right w-full"},"Prezzo",-1),pe={key:0,class:"text-right"},ge={key:0},me={key:1,class:"flex flex-column"},ve={class:"line-through"},ye={key:1,class:"text-right"},be={class:"flex align-items-center mb-1"};function Se(m,a,v,o,A,M){const S=g("InputText"),r=g("Column"),h=g("Avatar"),C=g("Badge"),F=g("Button"),y=g("DataTable"),d=ee("tooltip");return l(),n("div",ne,[i(y,{value:o.responseBundles.bundles,totalRecords:o.responseBundles.total,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":a[1]||(a[1]=e=>o.filters=e),ref:"dt",dataKey:"id",loading:o.loading,onPage:a[2]||(a[2]=e=>o.onPage(e)),onSort:a[3]||(a[3]=e=>o.onSort(e)),onFilter:a[4]||(a[4]=e=>o.onFilter()),removableSort:"",stripedRows:"",rowClass:o.getRowClass},{header:c(()=>[u("div",ie,[u("span",re,[ce,i(S,{modelValue:o.filters.global.value,"onUpdate:modelValue":a[0]||(a[0]=e=>o.filters.global.value=e),placeholder:"Ricerca per nome",class:"border-none w-full",onChange:o.loadLazyData},null,8,["modelValue","onChange"])])])]),empty:c(()=>[T(" Nessun pacchetto trovato. ")]),default:c(()=>[i(r,{field:"name",header:"Nome"},{body:c(({data:e})=>{var s;return[T(_((s=e==null?void 0:e.flat_translations.it)==null?void 0:s.title),1)]}),_:1}),i(r,{header:"Location",filterMatchMode:"contains",ref:"location",field:"location"},{body:c(({data:e})=>[T(_(e.location||"-"),1)]),_:1},512),i(r,{header:"Audio itinerari"},{body:c(({data:e})=>[u("div",null,[(l(!0),n(x,null,B(e.audio_guides,s=>{var p,k;return l(),n("div",{key:s.id,class:"truncate"},_((k=(p=s.flat_translations)==null?void 0:p.it)==null?void 0:k.title),1)}),128))])]),_:1}),i(r,{header:"Categoria",ref:"category",field:"category"},{body:c(({data:e})=>[u("div",ue,[(l(!0),n(x,null,B(e.categories,s=>(l(),n("span",{key:s.id},_(s.flat_translations.it),1))),128))])]),_:1},512),i(r,{header:"Tag",ref:"tag",field:"tag"},{body:c(({data:e})=>[u("div",de,[(l(!0),n(x,null,B(e.tags,s=>(l(),n("span",{key:s.id},_(s.flat_translations.it),1))),128))])]),_:1},512),i(r,{header:"Lingue",filterMatchMode:"contains",ref:"location",field:"location"},{body:c(({data:e})=>[u("div",fe,[(l(!0),n(x,null,B(e.languages,s=>(l(),n("span",{key:s.id},[u("img",{alt:s.code,src:te,class:z(`mr-2 flag flag-${s.code}`),style:{width:"18px"}},null,10,_e)]))),128))])]),_:1},512),i(r,{ref:"price",field:"price",style:{"min-width":"90px"}},{header:c(()=>[he]),body:c(({data:e})=>[e.price&&e.price!="0"?(l(),n("div",pe,[e.discounted_price?(l(),n("div",me,[u("span",ve,"€ "+_((e.price/100).toFixed(2)),1),u("b",null,"€ "+_((+e.discounted_price/100).toFixed(2)),1)])):(l(),n("span",ge,"€ "+_((+e.price/100).toFixed(2)),1))])):(l(),n("div",ye,"€ 0"))]),_:1},512),i(r,{header:"Guida",ref:"guide",field:"guide"},{body:c(({data:e})=>[(l(!0),n(x,null,B(e.guides,s=>(l(),n("div",{key:s.id},[u("div",be,[s&&s.image_url?(l(),se(h,{key:0,image:s.image_url.url,class:"mr-2",shape:"circle"},null,8,["image"])):oe("",!0),T(" "+_((s==null?void 0:s.full_name)||"-"),1)])]))),128))]),_:1},512),i(r,{header:"Stato",filterMatchMode:"contains",ref:"enabled",field:"enabled"},{body:c(({data:e})=>[i(C,{value:o.prettyStatus(e.status),class:z(["px-4 border-round-lg h-auto font-medium line-height-4",e.status])},null,8,["value","class"])]),_:1},512),i(r,{header:"",style:{width:"4rem"}},{body:c(({data:e})=>[le(i(F,{type:"button",onClick:s=>o.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[d,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading","rowClass"])])}const we=R(ae,[["render",Se]]),xe={setup(){const m=N(),a=L(()=>m.getTotalBundles),v=P();return{totalBundles:a,showSidebar:function(){v.setDetailType("bundle",!0,"Nuovo pacchetto",null),v.updateSidebar(!0),v.setShowDetail(!0)}}},components:{BundlesTable:we}},Be={class:"flex justify-content-between align-items-center"},Ce={class:""},ke={key:0},Te={key:1};function Ae(m,a,v,o,A,M){const S=g("Button"),r=g("BundlesTable");return l(),n("div",null,[u("div",Be,[u("h1",Ce,[o.totalBundles==1?(l(),n("span",ke," 1 Pacchetto")):(l(),n("span",Te,_(o.totalBundles)+" Pacchetti",1))]),i(S,{label:"Aggiungi",onClick:a[0]||(a[0]=h=>o.showSidebar()),class:"mb-3",rounded:"",outlined:"",icon:"pi pi-plus"})]),i(r)])}const Fe=R(xe,[["render",Ae]]);export{Fe as default};
