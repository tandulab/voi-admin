import{o as N,y as b,z as U,A as E,B as I,C as j,f as S,D as K,_ as O,r as h,h as n,i as r,k as a,j as i,w as _,t as p,E as Z,G as H,a as $,H as ee,g as V,J as te,K as oe,L as P,M as R,N as z,O as q,P as L,l as B,q as le}from"../index39897.js";const se={props:["filters"],setup(g,l){N(()=>{g.filters&&(m.value=Object.assign({},g.filters))});const m=b({}),t=U(),C=E(),w=I(),y=j(),v=S(()=>C.responseCategories),d=S(()=>t.allTags),G=S(()=>w.allGuides),c=S(()=>y.status);return{form:m,categories:v,tags:d,guides:G,statuses:c,prettyCategoryGroup:K,saveData:function(){},toggleCancel:function(){},resetFilter:function(){m.value=null,l.emit("onSaveFilter",m.value)}}}},ae={class:"filter-component"},ie={class:"col-12 flex m-0 p-0 align-items-center justify-content-between filter-header"},ne=a("h2",{class:"m-0"},"Filtri",-1),re={class:"formgrid grid mt-4 flex flex-column px-2"},de={class:"field"},ue=a("label",{for:"category"},"Categoria",-1),ce={class:"flex align-items-center"},fe={class:"field flex flex-column"},_e=a("label",{for:"tag"},"Tag",-1),me={class:"field flex flex-column"},ge=a("label",{for:"guide"},"Guida",-1),ve={class:"field flex flex-column"},pe=a("label",{for:"status"},"Stato",-1);function he(g,l,m,t,C,w){const y=h("Button"),v=h("Dropdown");return n(),r("div",ae,[a("div",ie,[ne,a("div",null,[i(y,{label:"Annulla",text:"",rounded:"",class:"mr-3",size:"small",onClick:l[0]||(l[0]=d=>t.resetFilter())}),i(y,{label:"Applica",outlined:"",rounded:"",size:"small",onClick:l[1]||(l[1]=d=>g.$emit("onSaveFilter",t.form))})])]),a("div",re,[a("div",de,[ue,i(v,{id:"category",modelValue:t.form.category_id,"onUpdate:modelValue":l[2]||(l[2]=d=>t.form.category_id=d),options:t.categories,optionLabel:"flat_translations.it",optionGroupLabel:"group",optionGroupChildren:"items",placeholder:"",class:"w-full"},{optiongroup:_(d=>[a("div",ce,[a("div",null,p(t.prettyCategoryGroup(d.option.group)),1)])]),_:1},8,["modelValue","options"])]),a("div",fe,[_e,i(v,{id:"tag",modelValue:t.form.tag,"onUpdate:modelValue":l[3]||(l[3]=d=>t.form.tag=d),options:t.tags,optionLabel:"flat_translations.it",placeholder:""},null,8,["modelValue","options"])]),a("div",me,[ge,i(v,{id:"guide",modelValue:t.form.guide,"onUpdate:modelValue":l[4]||(l[4]=d=>t.form.guide=d),options:t.guides,optionLabel:"full_name",placeholder:""},null,8,["modelValue","options"])]),a("div",ve,[pe,i(v,{id:"status",modelValue:t.form.status,"onUpdate:modelValue":l[5]||(l[5]=d=>t.form.status=d),options:t.statuses,optionLabel:"name",optionValue:"value",placeholder:""},null,8,["modelValue","options"])])])])}const ye=O(se,[["render",he]]),be={setup(){N(()=>{s.value=!0,f.value={first:0,rows:F.value.rows,sortField:null,sortOrder:null,filters:e.value},Z.register("myfilter",(o,u)=>o===u),k(),W(),Y(),X()});const g=j(),l=H(),m=E(),t=I(),C=U(),w=S(()=>g.status),y=S(()=>g.responseAudioGuide),v=S(()=>m.responseCategories),d=S(()=>t.allGuides),G=S(()=>C.allTags),c=$(),F=b(),T=b(),A=b(),M=b(),x=b(),e=b({global:{value:null,matchMode:"like"},name:{value:"",matchMode:"like"},category_id:{value:"",matchMode:"eq"},created_at:{value:"",matchMode:"like"},tag:{value:"",matchMode:"eq"},location:{value:"",matchMode:"eq"},guide:{value:"",matchMode:"eq"},status:{value:"",matchMode:"eq"}}),s=b(!0),f=b(),D=b(0),J=b([{label:"My Filter",value:"myfilter"}]);function k(){var u;s.value=!0;let o=new Map;(u=e.value.global)!=null&&u.value&&o.set("name_like",e.value.global.value),o=ee(e,o),o.delete("location_eq"),o.delete("global"),o.set("page",f.value.page+1),o.set("per_page",f.value.rows),f.value.sortField&&(f.value.sortOrder==1?o.set("sorted_by",f.value.sortField+"_asc"):o.set("sorted_by",f.value.sortField+"_desc")),setTimeout(()=>{Q(o)},Math.random()*1e3+250)}const Q=async function(o){await g.fetchAllAudioGuides(o).then(()=>{s.value=!1}).catch(u=>{s.value=!1,V(c,u)})},W=async function(){let o=new Map;await m.fetchAllCategories(o).then(()=>{s.value=!1}).catch(u=>{s.value=!1,V(c,u)})},X=async function(){let o=new Map;await t.fetchAllGuides(o).then(()=>{s.value=!1}).catch(u=>{s.value=!1,V(c,u)})},Y=async function(){await C.fetchAllTags().then(()=>{s.value=!1}).catch(o=>{s.value=!1,V(c,o)})};return{dt:F,responseAudioGuides:y,filters:e,loading:s,totalRecords:D,lazyParams:f,matchModes:J,currentAudioGuide:T,status:w,categories:v,guides:d,tags:G,op:A,form_filter:M,num_filter:x,onPage:o=>{f.value=o,k()},onSort:o=>{f.value=o,k()},showSidebar:function(o){l.setDetailType("audio_tour",!1,"Dettaglio audio itinerario",o.id),l.updateSidebar(!0)},loadLazyData:k,getRowClass:function(o){return o!=null&&o.cluster?o.cluster:""},prettyCategoryGroup:K,toggleFilters:o=>{A.value.toggle(o)},prettyStatus:te,onSaveFilter:o=>{if(x.value=0,M.value=Object.assign({},o),o)for(const[u,tt]of Object.entries(o))u=="category_id"||u=="tag"||u=="guide"?e.value[u].value=o[u].id:e.value[u].value=o[u],x.value+=1;k(),A.value.hide()},onRemove:o=>{delete M.value[o],k(),x.value-=1},formatDataFromUnixTimestamps:oe}},components:{AudioGuideFilters:ye}};const Se={class:"user-table"},xe={class:"w-full mb-3 chip-filters"},Ce={class:"flex justify-content-between align-items-center"},we={class:"p-input-icon-left w-full mr-3"},Ae={class:"flex align-items-center py-2"},ke=a("i",{class:"pi pi-search"},null,-1),Ge={class:"filter"},Fe={class:"flex flex-column line-height-3"},Me={class:"flex flex-column line-height-3"},Te={class:"flex flex-column line-height-3"},Ve={key:0,class:"text-right"},Re={key:0},ze={key:1,class:"flex flex-column"},Be={class:"line-through"},De={key:1,class:"text-right"},Le=a("div",{class:"flex justify-content-center w-full"},"Durata",-1),je={class:"flex justify-content-center"},Oe={key:0},Pe={key:1};function qe(g,l,m,t,C,w){const y=h("Chip"),v=h("InputText"),d=h("AudioGuideFilters"),G=h("OverlayPanel"),c=h("Column"),F=h("Badge"),T=h("Button"),A=h("DataTable"),M=P("badge"),x=P("tooltip");return n(),r("div",Se,[a("div",xe,[(n(!0),r(R,null,z(t.form_filter,(e,s)=>{var f;return n(),r("span",{key:s},[e.full_name?(n(),q(y,{key:0,label:e.full_name,removable:"",class:"capitalize mr-2",onRemove:D=>t.onRemove(s)},null,8,["label","onRemove"])):(n(),q(y,{key:1,label:e.flat_translations?(f=e.flat_translations)==null?void 0:f.it:e,removable:"",class:"capitalize mr-2",onRemove:D=>t.onRemove(s)},null,8,["label","onRemove"]))])}),128))]),i(A,{value:t.responseAudioGuides.audio_guides,totalRecords:t.responseAudioGuides.total,lazy:!0,paginator:!0,rows:30,ref:"dt",dataKey:"id",loading:t.loading,onPage:l[4]||(l[4]=e=>t.onPage(e)),onSort:l[5]||(l[5]=e=>t.onSort(e)),removableSort:"",stripedRows:"",rowClass:t.getRowClass},{header:_(()=>[a("div",Ce,[a("div",we,[a("span",Ae,[ke,i(v,{modelValue:t.filters.global.value,"onUpdate:modelValue":l[0]||(l[0]=e=>t.filters.global.value=e),placeholder:"Ricerca per nome",class:"border-none w-full pl-2",onChange:t.loadLazyData},null,8,["modelValue","onChange"])])]),a("div",Ge,[t.num_filter?L((n(),r("i",{key:0,class:"pi pi-filter p-overlay-badge cursor-pointer",onClick:l[1]||(l[1]=(...e)=>t.toggleFilters&&t.toggleFilters(...e)),style:{"font-size":"1.2rem"}},null,512)),[[M,t.num_filter+""],[x,"Filtri",void 0,{bottom:!0}]]):L((n(),r("i",{key:1,class:"pi pi-filter p-overlay-badge cursor-pointer",onClick:l[2]||(l[2]=(...e)=>t.toggleFilters&&t.toggleFilters(...e)),style:{"font-size":"1.2rem"}},null,512)),[[x,"Filtri",void 0,{bottom:!0}]])])]),i(G,{ref:"op",class:"p-2",style:{"min-width":"24rem"},dismissable:!1},{default:_(()=>[i(d,{onOnSaveFilter:l[3]||(l[3]=e=>t.onSaveFilter(e)),filters:t.form_filter},null,8,["filters"])]),_:1},512)]),empty:_(()=>[B(" Nessun audio itinerario trovato. ")]),default:_(()=>[i(c,{field:"name",header:"Nome",ref:"name",sortable:!1},{body:_(({data:e})=>{var s,f;return[B(p(((f=(s=e==null?void 0:e.translations.it)==null?void 0:s.title)==null?void 0:f.text)||"-"),1)]}),_:1},512),i(c,{header:"Location",filterMatchMode:"contains",ref:"location",field:"location"},{body:_(({data:e})=>[B(p(e.location||"-"),1)]),_:1},512),i(c,{header:"Categoria",ref:"category",field:"category"},{body:_(({data:e})=>[a("div",Fe,[(n(!0),r(R,null,z(e.categories,s=>(n(),r("span",{key:s.id},p(s.flat_translations.it),1))),128))])]),_:1},512),i(c,{header:"Tag",ref:"tag",field:"tag"},{body:_(({data:e})=>[a("div",Me,[(n(!0),r(R,null,z(e.tags,s=>(n(),r("span",{key:s.id},p(s.flat_translations.it),1))),128))])]),_:1},512),i(c,{header:"Lingue",filterMatchMode:"contains",ref:"location",field:"location"},{body:_(({data:e})=>[a("div",Te,[(n(!0),r(R,null,z(e.languages,s=>(n(),r("span",{key:s.id},p(s.language),1))),128))])]),_:1},512),i(c,{header:"Prezzo",ref:"price",field:"price",style:{"min-width":"90px"}},{body:_(({data:e})=>[e.price?(n(),r("div",Ve,[e.discounted_price?(n(),r("div",ze,[a("span",Be,"€ "+p(e.price/100),1),a("b",null,"€ "+p(e.discounted_price/100),1)])):(n(),r("span",Re,"€ "+p(e.price/100),1))])):(n(),r("div",De,"-"))]),_:1},512),i(c,{header:"",filterMatchMode:"contains",ref:"location",field:"location"},{header:_(()=>[Le]),body:_(({data:e})=>[a("div",je,[e.duration?(n(),r("span",Oe,p(e.duration)+" min",1)):(n(),r("span",Pe,"-"))])]),_:1},512),i(c,{header:"Guida",ref:"guide",field:"guide"},{body:_(({data:e})=>{var s;return[B(p(((s=e.guide)==null?void 0:s.full_name)||"-"),1)]}),_:1},512),i(c,{header:"Stato",filterMatchMode:"contains",ref:"enabled",field:"enabled"},{body:_(({data:e})=>[i(F,{value:t.prettyStatus(e.status),class:le(["px-4 border-round-lg h-auto font-medium line-height-4",e.status])},null,8,["value","class"])]),_:1},512),i(c,{header:"",style:{width:"4rem"}},{body:_(({data:e})=>[L(i(T,{type:"button",onClick:s=>t.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[x,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","loading","rowClass"])])}const Ne=O(be,[["render",qe]]),Ue={setup(){const g=j(),l=S(()=>g.getTotalAudioGuide),m=H();return{totalAudioGuide:l,showSidebar:function(){m.setDetailType("audio_tour",!0,"Nuovo audio itinerario",null),m.updateSidebar(!0),m.setShowDetail(!0)}}},components:{AudioGuideTable:Ne}},Ee={class:"flex justify-content-between align-items-center"},Ie={class:""},Ke={key:0},He={key:1};function Je(g,l,m,t,C,w){const y=h("Button"),v=h("AudioGuideTable");return n(),r("div",null,[a("div",Ee,[a("h1",Ie,[t.totalAudioGuide==1?(n(),r("span",Ke," 1 Audio itinerario")):(n(),r("span",He,p(t.totalAudioGuide)+" Audio itinerari",1))]),i(y,{label:"Aggiungi",onClick:l[0]||(l[0]=d=>t.showSidebar()),class:"mb-3",rounded:"",outlined:""})]),i(v)])}const lt=O(Ue,[["render",Je]]);export{lt as default};
