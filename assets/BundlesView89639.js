import{o as H,E as J,T as N,G as P,f as L,A as Q,B as $,z as W,H as X,a as Y,y as b,J as Z,g as w,K as ee,L as te,_ as R,r as v,M as oe,h as l,i as n,j as i,w as c,k as u,l as M,t as _,N as x,O as B,R as ae,q as z,P as le,S as se,Q as ne}from"../index89639.js";const ie={setup(){H(()=>{d.value=!0,e.value={first:0,rows:k.value.rows,sortField:null,sortOrder:null,filters:p.value},J.register("myfilter",(t,f)=>t===f),m(),U(),I(),E(),K()});const g=N(),s=P(),y=L(()=>g.status),a=Q(),T=$(),A=W(),S=X(),r=L(()=>g.responseBundle),h=Y(),k=b(),F=b(),p=b({global:{value:null,matchMode:"like"},name:{value:"",matchMode:"like"},email:{value:"",matchMode:"eq"},created_at:{value:"",matchMode:"like"},role:{value:"",matchMode:"eq"},location:{value:"",matchMode:"eq"},enabled:{value:"",matchMode:"eq"}}),d=b(!0),e=b(),o=b(0),C=b([{label:"My Filter",value:"myfilter"}]);function m(){var f;d.value=!0;let t=new Map;(f=p.value.global)!=null&&f.value&&t.set("name_like",p.value.global.value),t=Z(p,t),t.delete("location_eq"),t.delete("global"),t.set("page",e.value.page+1),t.set("per_page",e.value.rows),e.value.sortField&&(e.value.sortOrder==1?t.set("sorted_by",e.value.sortField+"_asc"):t.set("sorted_by",e.value.sortField+"_desc")),setTimeout(()=>{V(t)},Math.random()*1e3+250)}const V=async function(t){await g.fetchAllBundles(t).then(()=>{d.value=!1}).catch(f=>{d.value=!1,w(h,f)})},D=t=>{e.value=t,m()},q=t=>{e.value=t,m()},G=()=>{e.value.page=0,e.value.filters=p.value,m()},j=function(t){s.setDetailType("bundle",!1,"Dettaglio pacchetto",t.id),s.updateSidebar(!0)},O=function(t){return t!=null&&t.cluster?t.cluster:""},U=async function(){let t=new Map;await a.fetchAllCategories(t).then(()=>{d.value=!1}).catch(f=>{d.value=!1,w(h,f)})},E=async function(){let t=new Map;await T.fetchAllGuides(t).then(()=>{d.value=!1}).catch(f=>{d.value=!1,w(h,f)})},I=async function(){await A.fetchAllTags().then(()=>{d.value=!1}).catch(t=>{d.value=!1,w(h,t)})},K=async function(){await S.fetchAllLanguages().catch(t=>{w(h,t)})};return{dt:k,responseBundles:r,filters:p,loading:d,totalRecords:o,lazyParams:e,matchModes:C,currentBundle:F,status:y,onPage:D,onSort:q,onFilter:G,showSidebar:j,loadLazyData:m,getRowClass:O,prettyStatus:ee,formatDataFromUnixTimestamps:te}},components:{}};const re={class:"bundle-table"},ce={class:"flex justify-content-between align-items-center"},ue={class:"p-input-icon-left w-full mr-3 py-2"},de=u("i",{class:"pi pi-search"},null,-1),fe={class:"flex flex-column line-height-3"},_e={class:"flex flex-column line-height-3"},he={class:"flex align-items-center line-height-3"},pe=["alt"],me=u("div",{class:"text-right w-full"},"Prezzo",-1),ve={key:0,class:"text-right"},ge={key:0},ye={key:1,class:"flex flex-column"},be={class:"line-through"},Se={key:1,class:"text-right"},we={class:"flex align-items-center mb-1"};function xe(g,s,y,a,T,A){const S=v("InputText"),r=v("Column"),h=v("Avatar"),k=v("Badge"),F=v("Button"),p=v("DataTable"),d=oe("tooltip");return l(),n("div",re,[i(p,{value:a.responseBundles.bundles,totalRecords:a.responseBundles.total,lazy:!0,paginator:!0,rows:30,filters:a.filters,"onUpdate:filters":s[1]||(s[1]=e=>a.filters=e),ref:"dt",dataKey:"id",loading:a.loading,onPage:s[2]||(s[2]=e=>a.onPage(e)),onSort:s[3]||(s[3]=e=>a.onSort(e)),onFilter:s[4]||(s[4]=e=>a.onFilter()),removableSort:"",stripedRows:"",rowClass:a.getRowClass},{header:c(()=>[u("div",ce,[u("span",ue,[de,i(S,{modelValue:a.filters.global.value,"onUpdate:modelValue":s[0]||(s[0]=e=>a.filters.global.value=e),placeholder:"Ricerca per nome",class:"border-none w-full",onChange:a.loadLazyData},null,8,["modelValue","onChange"])])])]),empty:c(()=>[M(" Nessun pacchetto trovato. ")]),default:c(()=>[i(r,{field:"name",header:"Nome"},{body:c(({data:e})=>{var o;return[M(_((o=e==null?void 0:e.flat_translations.it)==null?void 0:o.title),1)]}),_:1}),i(r,{header:"Location",filterMatchMode:"contains",ref:"location",field:"location"},{body:c(({data:e})=>[M(_(e.location||"-"),1)]),_:1},512),i(r,{header:"Audio itinerari"},{body:c(({data:e})=>[u("div",null,[(l(!0),n(x,null,B(e.audio_guides,o=>{var C,m;return l(),n("div",{key:o.id,class:"truncate"},_((m=(C=o.flat_translations)==null?void 0:C.it)==null?void 0:m.title),1)}),128))])]),_:1}),i(r,{header:"Categoria",ref:"category",field:"category"},{body:c(({data:e})=>[u("div",fe,[(l(!0),n(x,null,B(e.categories,o=>(l(),n("span",{key:o.id},_(o.flat_translations.it),1))),128))])]),_:1},512),i(r,{header:"Tag",ref:"tag",field:"tag"},{body:c(({data:e})=>[u("div",_e,[(l(!0),n(x,null,B(e.tags,o=>(l(),n("span",{key:o.id},_(o.flat_translations.it),1))),128))])]),_:1},512),i(r,{header:"Lingue",filterMatchMode:"contains",ref:"location",field:"location"},{body:c(({data:e})=>[u("div",he,[(l(!0),n(x,null,B(e.languages,o=>(l(),n("span",{key:o.id},[u("img",{alt:o.code,src:ae,class:z(`mr-2 flag flag-${o.code}`),style:{width:"18px"}},null,10,pe)]))),128))])]),_:1},512),i(r,{ref:"price",field:"price",style:{"min-width":"90px"}},{header:c(()=>[me]),body:c(({data:e})=>[e.price&&e.price!="0"?(l(),n("div",ve,[e.discounted_price?(l(),n("div",ye,[u("span",be,"€ "+_((e.price/100).toFixed(2)),1),u("b",null,"€ "+_((+e.discounted_price/100).toFixed(2)),1)])):(l(),n("span",ge,"€ "+_((+e.price/100).toFixed(2)),1))])):(l(),n("div",Se,"€ 0"))]),_:1},512),i(r,{header:"Guida",ref:"guide",field:"guide"},{body:c(({data:e})=>[(l(!0),n(x,null,B(e.guides,o=>(l(),n("div",{key:o.id},[u("div",we,[o&&o.image_url?(l(),le(h,{key:0,image:o.image_url.url,class:"mr-2",shape:"circle"},null,8,["image"])):se("",!0),M(" "+_((o==null?void 0:o.full_name)||"-"),1)])]))),128))]),_:1},512),i(r,{header:"Stato",filterMatchMode:"contains",ref:"enabled",field:"enabled"},{body:c(({data:e})=>[i(k,{value:a.prettyStatus(e.status),class:z(["px-4 border-round-lg h-auto font-medium line-height-4",e.status])},null,8,["value","class"])]),_:1},512),i(r,{header:"",style:{width:"4rem"}},{body:c(({data:e})=>[ne(i(F,{type:"button",onClick:o=>a.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[d,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading","rowClass"])])}const Be=R(ie,[["render",xe]]),ke={setup(){const g=N(),s=L(()=>g.getTotalBundles),y=P();return{totalBundles:s,showSidebar:function(){y.setDetailType("bundle",!0,"Nuovo pacchetto",null),y.updateSidebar(!0),y.setShowDetail(!0)}}},components:{BundlesTable:Be}},Ce={class:"flex justify-content-between align-items-center"},Me={class:""},Te={key:0},Ae={key:1};function Fe(g,s,y,a,T,A){const S=v("Button"),r=v("BundlesTable");return l(),n("div",null,[u("div",Ce,[u("h1",Me,[a.totalBundles==1?(l(),n("span",Te," 1 Pacchetto")):(l(),n("span",Ae,_(a.totalBundles)+" Pacchetti",1))]),i(S,{label:"Aggiungi",onClick:s[0]||(s[0]=h=>a.showSidebar()),class:"mb-3",rounded:"",outlined:"",icon:"pi pi-plus"})]),i(r)])}const ze=R(ke,[["render",Fe]]);export{ze as default};
