import{o as D,E as N,T as P,G as A,f as T,a as V,y as v,J as z,g as q,K as L,L as j,_ as R,r as h,M as O,h as a,i as r,j as i,w as d,k as u,l as w,t as _,N as C,O as M,R as U,q as F,P as E,S as G,Q as I}from"../index99060.js";const K={setup(){D(()=>{f.value=!0,c.value={first:0,rows:x.value.rows,sortField:null,sortOrder:null,filters:s.value},N.register("myfilter",(t,b)=>t===b),g()});const p=P(),l=A(),m=T(()=>p.status),o=T(()=>p.responseBundle),B=V(),x=v(),y=v(),s=v({global:{value:null,matchMode:"like"},name:{value:"",matchMode:"like"},email:{value:"",matchMode:"eq"},created_at:{value:"",matchMode:"like"},role:{value:"",matchMode:"eq"},location:{value:"",matchMode:"eq"},enabled:{value:"",matchMode:"eq"}}),f=v(!0),c=v(),S=v(0),k=v([{label:"My Filter",value:"myfilter"}]);function g(){var b;f.value=!0;let t=new Map;(b=s.value.global)!=null&&b.value&&t.set("name_like",s.value.global.value),t=z(s,t),t.delete("location_eq"),t.delete("global"),t.set("page",c.value.page+1),t.set("per_page",c.value.rows),c.value.sortField&&(c.value.sortOrder==1?t.set("sorted_by",c.value.sortField+"_asc"):t.set("sorted_by",c.value.sortField+"_desc")),setTimeout(()=>{e(t)},Math.random()*1e3+250)}const e=async function(t){await p.fetchAllBundles(t).then(()=>{f.value=!1}).catch(b=>{f.value=!1,q(B,b)})};return{dt:x,responseBundles:o,filters:s,loading:f,totalRecords:S,lazyParams:c,matchModes:k,currentBundle:y,status:m,onPage:t=>{c.value=t,g()},onSort:t=>{c.value=t,g()},onFilter:()=>{c.value.page=0,c.value.filters=s.value,g()},showSidebar:function(t){l.setDetailType("bundle",!1,"Dettaglio pacchetto",t.id),l.updateSidebar(!0)},loadLazyData:g,getRowClass:function(t){return t!=null&&t.cluster?t.cluster:""},prettyStatus:L,formatDataFromUnixTimestamps:j}},components:{}};const J={class:"bundle-table"},Q={class:"flex justify-content-between align-items-center"},$={class:"p-input-icon-left w-full mr-3 py-2"},H=u("i",{class:"pi pi-search"},null,-1),W={class:"flex flex-column line-height-3"},X={class:"flex flex-column line-height-3"},Y={class:"flex align-items-center line-height-3"},Z=["alt"],ee={key:0,class:"text-right"},te={key:0},oe={key:1,class:"flex flex-column"},se={class:"line-through"},le={key:1,class:"text-right"},ne=u("div",{class:"flex justify-content-center w-full"},"Durata",-1),ae={class:"flex justify-content-center"},ie={key:0},re={key:1},ce={class:"flex align-items-center"};function de(p,l,m,o,B,x){const y=h("InputText"),s=h("Column"),f=h("Avatar"),c=h("Badge"),S=h("Button"),k=h("DataTable"),g=O("tooltip");return a(),r("div",J,[i(k,{value:o.responseBundles.bundles,totalRecords:o.responseBundles.total,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":l[1]||(l[1]=e=>o.filters=e),ref:"dt",dataKey:"id",loading:o.loading,onPage:l[2]||(l[2]=e=>o.onPage(e)),onSort:l[3]||(l[3]=e=>o.onSort(e)),onFilter:l[4]||(l[4]=e=>o.onFilter()),removableSort:"",stripedRows:"",rowClass:o.getRowClass},{header:d(()=>[u("div",Q,[u("span",$,[H,i(y,{modelValue:o.filters.global.value,"onUpdate:modelValue":l[0]||(l[0]=e=>o.filters.global.value=e),placeholder:"Ricerca per nome",class:"border-none w-full",onChange:o.loadLazyData},null,8,["modelValue","onChange"])])])]),empty:d(()=>[w(" Nessun pacchetto trovato. ")]),default:d(()=>[i(s,{field:"name",header:"Nome"},{body:d(({data:e})=>{var n;return[w(_((n=e==null?void 0:e.flat_translations.it)==null?void 0:n.title),1)]}),_:1}),i(s,{header:"Location",filterMatchMode:"contains",ref:"location",field:"location"},{body:d(({data:e})=>[w(_(e.location||"-"),1)]),_:1},512),i(s,{header:"Categoria",ref:"category",field:"category"},{body:d(({data:e})=>[u("div",W,[(a(!0),r(C,null,M(e.categories,n=>(a(),r("span",{key:n.id},_(n.flat_translations.it),1))),128))])]),_:1},512),i(s,{header:"Tag",ref:"tag",field:"tag"},{body:d(({data:e})=>[u("div",X,[(a(!0),r(C,null,M(e.tags,n=>(a(),r("span",{key:n.id},_(n.flat_translations.it),1))),128))])]),_:1},512),i(s,{header:"Lingue",filterMatchMode:"contains",ref:"location",field:"location"},{body:d(({data:e})=>[u("div",Y,[(a(!0),r(C,null,M(e.languages,n=>(a(),r("span",{key:n.id},[u("img",{alt:n.code,src:U,class:F(`mr-2 flag flag-${n.code}`),style:{width:"18px"}},null,10,Z)]))),128))])]),_:1},512),i(s,{header:"Prezzo",ref:"price",field:"price",style:{"min-width":"90px"}},{body:d(({data:e})=>[e.price&&e.price!="0"?(a(),r("div",ee,[e.discounted_price?(a(),r("div",oe,[u("span",se,"€ "+_((e.price/100).toFixed(2)),1),u("b",null,"€ "+_((+e.discounted_price/100).toFixed(2)),1)])):(a(),r("span",te,"€ "+_((+e.price/100).toFixed(2)),1))])):(a(),r("div",le,"€ 0"))]),_:1},512),i(s,{header:"",filterMatchMode:"contains",ref:"location",field:"location"},{header:d(()=>[ne]),body:d(({data:e})=>[u("div",ae,[e.duration?(a(),r("span",ie,_(e.duration)+" min",1)):(a(),r("span",re,"-"))])]),_:1},512),i(s,{header:"Guida",ref:"guide",field:"guide"},{body:d(({data:e})=>{var n;return[u("div",ce,[e.guide&&e.guide.image_url?(a(),E(f,{key:0,image:e.guide.image_url.url,class:"mr-2",shape:"circle"},null,8,["image"])):G("",!0),w(" "+_(((n=e.guide)==null?void 0:n.full_name)||"-"),1)])]}),_:1},512),i(s,{header:"Stato",filterMatchMode:"contains",ref:"enabled",field:"enabled"},{body:d(({data:e})=>[i(c,{value:o.prettyStatus(e.status),class:F(["px-4 border-round-lg h-auto font-medium line-height-4",e.status])},null,8,["value","class"])]),_:1},512),i(s,{header:"",style:{width:"4rem"}},{body:d(({data:e})=>[I(i(S,{type:"button",onClick:n=>o.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[g,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading","rowClass"])])}const ue=R(K,[["render",de]]),_e={setup(){const p=P(),l=T(()=>p.getTotalBundles),m=A();return{totalBundles:l,showSidebar:function(){m.setDetailType("Pacchetto",!0,"Nuovo pacchetto",null),m.updateSidebar(!0),m.setShowDetail(!0)}}},components:{BundlesTable:ue}},fe={class:"flex justify-content-between align-items-center"},he={class:""},pe={key:0},me={key:1};function ge(p,l,m,o,B,x){const y=h("Button"),s=h("BundlesTable");return a(),r("div",null,[u("div",fe,[u("h1",he,[o.totalBundles==1?(a(),r("span",pe," 1 Pacchetto")):(a(),r("span",me,_(o.totalBundles)+" Pacchetti",1))]),i(y,{label:"Aggiungi pacchetto",onClick:l[0]||(l[0]=f=>o.showSidebar()),class:"mb-3",rounded:"",outlined:""})]),i(s)])}const Be=R(_e,[["render",ge]]);export{Be as default};
