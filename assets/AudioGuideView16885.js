import{o as E,y,z as I,A as K,B as H,C as N,f as x,D as J,_ as P,r as m,h as i,i as r,k as a,j as n,w as f,t as b,E as re,G as Q,H as de,a as ce,J as ue,g as V,K as fe,L as _e,M as q,N as z,O as L,P as j,Q as O,l as B,R as ge,q as U,S as me}from"../index16885.js";const ve={props:["filters"],setup(v,l){E(()=>{v.filters&&(_.value=Object.assign({},v.filters))});const _=y({}),t=I(),C=K(),w=H(),h=N(),p=x(()=>C.responseCategories),d=x(()=>t.allTags),G=x(()=>w.allGuides),g=x(()=>h.status);return{form:_,categories:p,tags:d,guides:G,statuses:g,prettyCategoryGroup:J,saveData:function(){},toggleCancel:function(){},resetFilter:function(){_.value=null,l.emit("onSaveFilter",_.value)}}}},pe={class:"filter-component"},he={class:"col-12 flex m-0 p-0 align-items-center justify-content-between filter-header"},ye=a("h2",{class:"m-0"},"Filtri",-1),be={class:"formgrid grid mt-4 flex flex-column px-2"},xe={class:"field"},Se=a("label",{for:"category"},"Categoria",-1),Ae={class:"flex align-items-center"},Ce={class:"field flex flex-column"},we=a("label",{for:"tag"},"Tag",-1),ke={class:"field flex flex-column"},Ge=a("label",{for:"guide"},"Guida",-1),Fe={class:"field flex flex-column"},Me=a("label",{for:"status"},"Stato",-1);function Te(v,l,_,t,C,w){const h=m("Button"),p=m("Dropdown");return i(),r("div",pe,[a("div",he,[ye,a("div",null,[n(h,{label:"Annulla",text:"",rounded:"",class:"mr-3",size:"small",onClick:l[0]||(l[0]=d=>t.resetFilter())}),n(h,{label:"Applica",outlined:"",rounded:"",size:"small",onClick:l[1]||(l[1]=d=>v.$emit("onSaveFilter",t.form))})])]),a("div",be,[a("div",xe,[Se,n(p,{id:"category",modelValue:t.form.category_id,"onUpdate:modelValue":l[2]||(l[2]=d=>t.form.category_id=d),options:t.categories,optionLabel:"flat_translations.it",optionGroupLabel:"group",optionGroupChildren:"items",placeholder:"",class:"w-full"},{optiongroup:f(d=>[a("div",Ae,[a("div",null,b(t.prettyCategoryGroup(d.option.group)),1)])]),_:1},8,["modelValue","options"])]),a("div",Ce,[we,n(p,{id:"tag",modelValue:t.form.tag,"onUpdate:modelValue":l[3]||(l[3]=d=>t.form.tag=d),options:t.tags,optionLabel:"flat_translations.it",placeholder:""},null,8,["modelValue","options"])]),a("div",ke,[Ge,n(p,{id:"guide",modelValue:t.form.guide,"onUpdate:modelValue":l[4]||(l[4]=d=>t.form.guide=d),options:t.guides,optionLabel:"full_name",placeholder:""},null,8,["modelValue","options"])]),a("div",Fe,[Me,n(p,{id:"status",modelValue:t.form.status,"onUpdate:modelValue":l[5]||(l[5]=d=>t.form.status=d),options:t.statuses,optionLabel:"name",optionValue:"value",placeholder:""},null,8,["modelValue","options"])])])])}const Ve=P(ve,[["render",Te]]),Re={setup(){E(()=>{s.value=!0,u.value={first:0,rows:F.value.rows,sortField:null,sortOrder:null,filters:e.value},re.register("myfilter",(o,c)=>o===c),k(),X(),Z(),Y(),ne()});const v=N(),l=Q(),_=K(),t=H(),C=I(),w=de(),h=x(()=>v.status),p=x(()=>v.responseAudioGuide),d=x(()=>_.responseCategories),G=x(()=>t.allGuides),g=x(()=>C.allTags),S=ce(),F=y(),R=y(),M=y(),T=y(),A=y(),e=y({global:{value:null,matchMode:"like"},name:{value:"",matchMode:"like"},category_id:{value:"",matchMode:"eq"},created_at:{value:"",matchMode:"like"},tag:{value:"",matchMode:"eq"},location:{value:"",matchMode:"eq"},guide:{value:"",matchMode:"eq"},status:{value:"",matchMode:"eq"}}),s=y(!0),u=y(),D=y(0),$=y([{label:"My Filter",value:"myfilter"}]);function k(){var c;s.value=!0;let o=new Map;(c=e.value.global)!=null&&c.value&&o.set("it_title_like",e.value.global.value),o=ue(e,o),o.delete("location_eq"),o.delete("global"),o.set("page",u.value.page+1),o.set("per_page",u.value.rows),u.value.sortField&&(u.value.sortOrder==1?o.set("sorted_by",u.value.sortField+"_asc"):o.set("sorted_by",u.value.sortField+"_desc")),setTimeout(()=>{W(o)},Math.random()*1e3+250)}const W=async function(o){await v.fetchAllAudioGuides(o).then(()=>{s.value=!1}).catch(c=>{s.value=!1,V(S,c)})},X=async function(){let o=new Map;await _.fetchAllCategories(o).then(()=>{s.value=!1}).catch(c=>{s.value=!1,V(S,c)})},Y=async function(){let o=new Map;await t.fetchAllGuides(o).then(()=>{s.value=!1}).catch(c=>{s.value=!1,V(S,c)})},Z=async function(){await C.fetchAllTags().then(()=>{s.value=!1}).catch(o=>{s.value=!1,V(S,o)})},ee=o=>{u.value=o,k()},te=o=>{u.value=o,k()},oe=function(o){l.setDetailType("audio_tour",!1,"Dettaglio audio itinerario",o.id),l.updateSidebar(!0)},le=function(o){return o!=null&&o.cluster?o.cluster:""},se=o=>{M.value.toggle(o)},ae=o=>{if(A.value=0,T.value=Object.assign({},o),o)for(const[c,rt]of Object.entries(o))c=="category_id"||c=="tag"||c=="guide"?e.value[c].value=o[c].id:e.value[c].value=o[c],A.value+=1;k(),M.value.hide()},ie=o=>{delete T.value[o],k(),A.value-=1},ne=async function(){await w.fetchAllLanguages().catch(o=>{V(S,o)})};return{dt:F,responseAudioGuides:p,filters:e,loading:s,totalRecords:D,lazyParams:u,matchModes:$,currentAudioGuide:R,status:h,categories:d,guides:G,tags:g,op:M,form_filter:T,num_filter:A,onPage:ee,onSort:te,showSidebar:oe,loadLazyData:k,getRowClass:le,prettyCategoryGroup:J,toggleFilters:se,prettyStatus:fe,onSaveFilter:ae,onRemove:ie,formatDataFromUnixTimestamps:_e}},components:{AudioGuideFilters:Ve}};const ze={class:"user-table"},Le={class:"w-full mb-3 chip-filters"},Be={class:"flex justify-content-between align-items-center"},De={class:"p-input-icon-left w-full mr-3"},je={class:"flex align-items-center py-2"},Oe=a("i",{class:"pi pi-search"},null,-1),Ne={class:"filter"},Pe={class:"flex flex-column line-height-3"},qe={class:"flex flex-column line-height-3"},Ue={class:"flex align-items-center line-height-3"},Ee=["alt"],Ie={key:0,class:"text-right"},Ke={key:0},He={key:1,class:"flex flex-column"},Je={class:"line-through"},Qe={key:1,class:"text-right"},$e=a("div",{class:"flex justify-content-center w-full"},"Durata",-1),We={class:"flex justify-content-center"},Xe={key:0},Ye={key:1},Ze={class:"flex align-items-center"};function et(v,l,_,t,C,w){const h=m("Chip"),p=m("InputText"),d=m("AudioGuideFilters"),G=m("OverlayPanel"),g=m("Column"),S=m("Avatar"),F=m("Badge"),R=m("Button"),M=m("DataTable"),T=q("badge"),A=q("tooltip");return i(),r("div",ze,[a("div",Le,[(i(!0),r(z,null,L(t.form_filter,(e,s)=>{var u;return i(),r("span",{key:s},[e.full_name?(i(),j(h,{key:0,label:e.full_name,removable:"",class:"capitalize mr-2",onRemove:D=>t.onRemove(s)},null,8,["label","onRemove"])):(i(),j(h,{key:1,label:e.flat_translations?(u=e.flat_translations)==null?void 0:u.it:e,removable:"",class:"capitalize mr-2",onRemove:D=>t.onRemove(s)},null,8,["label","onRemove"]))])}),128))]),n(M,{value:t.responseAudioGuides.audio_guides,totalRecords:t.responseAudioGuides.total,lazy:!0,paginator:!0,rows:30,ref:"dt",dataKey:"id",loading:t.loading,onPage:l[4]||(l[4]=e=>t.onPage(e)),onSort:l[5]||(l[5]=e=>t.onSort(e)),removableSort:"",stripedRows:"",rowClass:t.getRowClass},{header:f(()=>[a("div",Be,[a("div",De,[a("span",je,[Oe,n(p,{modelValue:t.filters.global.value,"onUpdate:modelValue":l[0]||(l[0]=e=>t.filters.global.value=e),placeholder:"Ricerca per nome",class:"border-none w-full pl-2",onChange:t.loadLazyData},null,8,["modelValue","onChange"])])]),a("div",Ne,[t.num_filter?O((i(),r("i",{key:0,class:"pi pi-filter p-overlay-badge cursor-pointer",onClick:l[1]||(l[1]=(...e)=>t.toggleFilters&&t.toggleFilters(...e)),style:{"font-size":"1.2rem"}},null,512)),[[T,t.num_filter+""],[A,"Filtri",void 0,{bottom:!0}]]):O((i(),r("i",{key:1,class:"pi pi-filter p-overlay-badge cursor-pointer",onClick:l[2]||(l[2]=(...e)=>t.toggleFilters&&t.toggleFilters(...e)),style:{"font-size":"1.2rem"}},null,512)),[[A,"Filtri",void 0,{bottom:!0}]])])]),n(G,{ref:"op",class:"p-2",style:{"min-width":"24rem"},dismissable:!1},{default:f(()=>[n(d,{onOnSaveFilter:l[3]||(l[3]=e=>t.onSaveFilter(e)),filters:t.form_filter},null,8,["filters"])]),_:1},512)]),empty:f(()=>[B(" Nessun audio itinerario trovato. ")]),default:f(()=>[n(g,{field:"name",header:"Nome",ref:"name",sortable:!1},{body:f(({data:e})=>{var s,u;return[B(b(((u=(s=e==null?void 0:e.translations.it)==null?void 0:s.title)==null?void 0:u.text)||"-"),1)]}),_:1},512),n(g,{header:"Location",filterMatchMode:"contains",ref:"location",field:"location"},{body:f(({data:e})=>[B(b(e.location||"-"),1)]),_:1},512),n(g,{header:"Categoria",ref:"category",field:"category"},{body:f(({data:e})=>[a("div",Pe,[(i(!0),r(z,null,L(e.categories,s=>(i(),r("span",{key:s.id},b(s.flat_translations.it),1))),128))])]),_:1},512),n(g,{header:"Tag",ref:"tag",field:"tag"},{body:f(({data:e})=>[a("div",qe,[(i(!0),r(z,null,L(e.tags,s=>(i(),r("span",{key:s.id},b(s.flat_translations.it),1))),128))])]),_:1},512),n(g,{header:"Lingue",filterMatchMode:"contains",ref:"location",field:"location"},{body:f(({data:e})=>[a("div",Ue,[(i(!0),r(z,null,L(e.languages,s=>(i(),r("span",{key:s.id},[a("img",{alt:s.code,src:ge,class:U(`mr-2 flag flag-${s.code}`),style:{width:"18px"}},null,10,Ee)]))),128))])]),_:1},512),n(g,{header:"Prezzo",ref:"price",field:"price",style:{"min-width":"90px"}},{body:f(({data:e})=>[e.price&&e.price!="0"?(i(),r("div",Ie,[e.discounted_price?(i(),r("div",He,[a("span",Je,"€ "+b((e.price/100).toFixed(2)),1),a("b",null,"€ "+b((+e.discounted_price/100).toFixed(2)),1)])):(i(),r("span",Ke,"€ "+b((+e.price/100).toFixed(2)),1))])):(i(),r("div",Qe,"€ 0"))]),_:1},512),n(g,{header:"",filterMatchMode:"contains",ref:"location",field:"location"},{header:f(()=>[$e]),body:f(({data:e})=>[a("div",We,[e.duration?(i(),r("span",Xe,b(e.duration)+" min",1)):(i(),r("span",Ye,"-"))])]),_:1},512),n(g,{header:"Guida",ref:"guide",field:"guide"},{body:f(({data:e})=>{var s;return[a("div",Ze,[e.guide&&e.guide.image_url?(i(),j(S,{key:0,image:e.guide.image_url.url,class:"mr-2",shape:"circle"},null,8,["image"])):me("",!0),B(" "+b(((s=e.guide)==null?void 0:s.full_name)||"-"),1)])]}),_:1},512),n(g,{header:"Stato",filterMatchMode:"contains",ref:"enabled",field:"enabled"},{body:f(({data:e})=>[n(F,{value:t.prettyStatus(e.status),class:U(["px-4 border-round-lg h-auto font-medium line-height-4",e.status])},null,8,["value","class"])]),_:1},512),n(g,{header:"",style:{width:"4rem"}},{body:f(({data:e})=>[O(n(R,{type:"button",onClick:s=>t.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[A,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","loading","rowClass"])])}const tt=P(Re,[["render",et]]),ot={setup(){const v=N(),l=x(()=>v.getTotalAudioGuide),_=Q();return{totalAudioGuide:l,showSidebar:function(){_.setDetailType("audio_tour",!0,"Nuovo audio itinerario",null),_.updateSidebar(!0),_.setShowDetail(!0)}}},components:{AudioGuideTable:tt}},lt={class:"flex justify-content-between align-items-center"},st={class:""},at={key:0},it={key:1};function nt(v,l,_,t,C,w){const h=m("Button"),p=m("AudioGuideTable");return i(),r("div",null,[a("div",lt,[a("h1",st,[t.totalAudioGuide==1?(i(),r("span",at," 1 Audio itinerario")):(i(),r("span",it,b(t.totalAudioGuide)+" Audio itinerari",1))]),n(h,{label:"Aggiungi",onClick:l[0]||(l[0]=d=>t.showSidebar()),class:"mb-3",rounded:"",outlined:""})]),n(p)])}const ct=P(ot,[["render",nt]]);export{ct as default};
