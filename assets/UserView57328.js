import{o as $,E as j,Y as R,G as k,f as V,U as A,a as E,y as _,J as G,g as x,p as J,Z as X,L as Y,s as Z,_ as K,r as p,h as b,i as g,j as n,w as i,k as F,l as T,S,t as M,P as H,q as Q,X as W}from"../index57328.js";const ee={setup(){$(()=>{c.value=!0,r.value={first:0,rows:U.value.rows,sortField:null,sortOrder:null,filters:y.value},j.register("myfilter",(t,d)=>t===d),a()});const m=R(),s=k(),f=V(()=>m.responseUsers),o=V(()=>m.userRoles),C=V(()=>m.status),w=A(),h=V(()=>w.submitDialog),u=E(),U=_(),v=_(),y=_({global:{value:null,matchMode:"like"},email:{value:"",matchMode:"eq"},created_at:{value:"",matchMode:"like"},birthdate:{value:"",matchMode:"like"},role:{value:"",matchMode:"eq"},enabled:{value:"",matchMode:"eq"},wp_id:{value:"",matchMode:"eq"}}),c=_(!0),r=_(),e=_(0),l=_([{label:"My Filter",value:"myfilter"}]);function a(){c.value=!0;let t=new Map;t=G(y,t),t.delete("location_eq"),t.delete("global"),t.set("page",r.value.page+1),t.set("per_page",r.value.rows),r.value.sortField&&(r.value.sortOrder==1?t.set("sorted_by",r.value.sortField+"_asc"):t.set("sorted_by",r.value.sortField+"_desc")),setTimeout(()=>{I(t)},Math.random()*1e3+250)}const I=async function(t){await m.fetchAllUsers(t).then(()=>{c.value=!1}).catch(d=>{c.value=!1,x(u,d)})},O=t=>{r.value=t,a()},P=t=>{r.value=t,a()},q=()=>{r.value.page=0,r.value.filters=y.value,a()},z=function(t){s.setDetailType("user",!1,"Dettaglio utente",t.id),s.updateSidebar(!0)},B=function(t,d){t.stopPropagation(),t.stopImmediatePropagation(),v.value=d;let D="Sei sicuro di voler disattivare l'utente <b>"+(d==null?void 0:d.email)+"</b> ?";w.setDialog("Cambia stato","Conferma","Annulla",D),w.setDynamicDialogVisibility(!0)},N=async function(){var d;c.value=!0;const t={user_id:v.value.id,user:{enabled:(d=v.value)==null?void 0:d.enabled}};await m.updateUser(t).then(()=>{c.value=!1,Z(u,{message:"Stato aggiornato correttamente",error:!1}),a()}).catch(D=>{c.value=!1,x(u,D)})},L=function(t){return t!=null&&t.cluster?t.cluster:""};return J(h,()=>{N()}),{dt:U,responseUsers:f,filters:y,loading:c,totalRecords:e,lazyParams:r,matchModes:l,userRoles:o,currentUser:v,status:C,onPage:O,onSort:P,onFilter:q,showSidebar:z,loadLazyData:a,onChangeStatus:B,getRowClass:L,prettyUserRole:X,formatDataFromUnixTimestamps:Y}},components:{}};const te={class:"user-table"},ae={class:"flex justify-content-between align-items-center"},oe={class:"p-input-icon-left w-full mr-3 py-2"},le=F("i",{class:"pi pi-search"},null,-1),se={key:0},ne={key:1};function re(m,s,f,o,C,w){const h=p("InputText"),u=p("Column"),U=p("Calendar"),v=p("Dropdown"),y=p("Badge"),c=p("InputSwitch"),r=p("DataTable");return b(),g("div",te,[n(r,{value:o.responseUsers.users,totalRecords:o.responseUsers.total,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":s[1]||(s[1]=e=>o.filters=e),ref:"dt",dataKey:"id",loading:o.loading,onPage:s[2]||(s[2]=e=>o.onPage(e)),onSort:s[3]||(s[3]=e=>o.onSort(e)),onFilter:s[4]||(s[4]=e=>o.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:"",rowClass:o.getRowClass},{header:i(()=>[F("div",ae,[F("span",oe,[le,n(h,{modelValue:o.filters.global.value,"onUpdate:modelValue":s[0]||(s[0]=e=>o.filters.global.value=e),placeholder:"Ricerca utente",class:"border-none w-full",onChange:o.loadLazyData},null,8,["modelValue","onChange"])])])]),empty:i(()=>[T(" Nessun utente trovato. ")]),default:i(()=>[n(u,{field:"email",header:"Email",filterMatchMode:"contains",ref:"email",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:i(({filterModel:e,filterCallback:l})=>[n(h,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,onKeydown:S(a=>l(),["enter"]),class:"p-column-filter",placeholder:"Filtra per email"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(u,{header:"Data di nascita",field:"birthdate",filterMatchMode:"contains",ref:"birthdate",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:i(({filterModel:e,filterCallback:l})=>[n(U,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"dd/mm/yy",onKeydown:S(a=>l(),["enter"]),manualInput:!1,placeholder:"Filtra per data",onDateSelect:a=>l()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),body:i(({data:e})=>[e.birthdate?(b(),g("span",se,M(e==null?void 0:e.birthdate),1)):(b(),g("span",ne,"-"))]),_:1},512),n(u,{header:"Data creazione",field:"created_at",filterMatchMode:"contains",ref:"created_at",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:i(({filterModel:e,filterCallback:l})=>[n(U,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,dateFormat:"dd/mm/yy",onKeydown:S(a=>l(),["enter"]),manualInput:!1,placeholder:"Filtra per data",onDateSelect:a=>l()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),body:i(({data:e})=>[T(M(o.formatDataFromUnixTimestamps(e==null?void 0:e.created_at)),1)]),_:1},512),n(u,{field:"wp_id",header:"wp_id",filterMatchMode:"contains",ref:"wp_id",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:i(({data:e})=>[T(M(e.wp_id||"-"),1)]),filter:i(({filterModel:e,filterCallback:l})=>[n(h,{type:"text",modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,onKeydown:S(a=>l(),["enter"]),class:"p-column-filter",placeholder:"Filtra per wp_id"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(u,{header:"Ruolo",ref:"role",field:"role",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,sortable:""},{filter:i(({filterModel:e,filterCallback:l})=>[n(v,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:o.userRoles,optionLabel:"name",optionValue:"value",onChange:a=>l(),placeholder:"Filtra per ruolo"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),body:i(({data:e})=>[e&&e.role?(b(),H(y,{key:0,value:o.prettyUserRole(e.role),class:Q(["px-4 border-round-lg h-auto font-medium line-height-4",e.role])},null,8,["value","class"])):W("",!0)]),_:1},512),n(u,{header:"Stato",filterMatchMode:"contains",ref:"enabled",field:"enabled",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:i(({filterModel:e,filterCallback:l})=>[n(v,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,options:o.status,optionLabel:"name",optionValue:"value",onChange:a=>l(),placeholder:"Filtra per stato"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),body:i(({data:e})=>[n(c,{modelValue:e.enabled,"onUpdate:modelValue":l=>e.enabled=l,onChange:l=>o.onChangeStatus(l,e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},512)]),_:1},8,["value","totalRecords","filters","loading","rowClass"])])}const ie=K(ee,[["render",re]]),de={setup(){const m=R(),s=V(()=>m.getTotalUsers),f=k();return{totalUser:s,showSidebar:function(){f.setDetailType("user",!0,"Nuovo utente",null),f.updateSidebar(!0),f.setShowDetail(!0)}}},components:{UsersTable:ie}},ue={class:"flex justify-content-between align-items-center"},ce={class:""},me={key:0},pe={key:1};function fe(m,s,f,o,C,w){const h=p("UsersTable");return b(),g("div",null,[F("div",ue,[F("h1",ce,[o.totalUser==1?(b(),g("span",me," 1 Utente")):(b(),g("span",pe,M(o.totalUser)+" Utenti",1))])]),n(h)])}const ve=K(de,[["render",fe]]);export{ve as default};
