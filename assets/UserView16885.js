import{o as A,E,Z as K,G as I,f as U,W as G,a as J,y as v,J as W,g as R,p as k,$ as Z,a0 as H,L as Q,s as X,_ as O,r as p,h as _,i as V,j as n,w as i,k as M,l as x,U as D,t as C,P as Y,q as ee,S as te}from"../index16885.js";const ae={setup(){A(()=>{d.value=!0,e.value={first:0,rows:F.value.rows,sortField:null,sortOrder:null,filters:g.value},E.register("myfilter",(t,r)=>t===r),w()});const u=K(),s=I(),f=U(()=>u.responseUsers),a=U(()=>u.userRoles),T=U(()=>u.status),b=G(),h=U(()=>b.submitDialog),c=U(()=>b.cancelDialog),y=J(),F=v(),m=v(),g=v({global:{value:null,matchMode:"like"},email:{value:"",matchMode:"eq"},created_at:{value:"",matchMode:"like"},birthdate:{value:"",matchMode:"like"},role:{value:"",matchMode:"eq"},enabled:{value:"",matchMode:"eq"},wp_id:{value:"",matchMode:"eq"}}),d=v(!0),e=v(),l=v(0),o=v([{label:"My Filter",value:"myfilter"}]);function w(){d.value=!0;let t=new Map;t=W(g,t),t.delete("location_eq"),t.delete("global"),t.set("page",e.value.page+1),t.set("per_page",e.value.rows),e.value.sortField&&(e.value.sortOrder==1?t.set("sorted_by",e.value.sortField+"_asc"):t.set("sorted_by",e.value.sortField+"_desc")),setTimeout(()=>{P(t)},Math.random()*1e3+250)}const P=async function(t){await u.fetchAllUsers(t).then(()=>{d.value=!1}).catch(r=>{d.value=!1,R(y,r)})},q=t=>{e.value=t,w()},z=t=>{e.value=t,w()},B=()=>{e.value.page=0,e.value.filters=g.value,w()},N=function(t){s.setDetailType("user",!1,"Dettaglio utente",t.id),s.updateSidebar(!0)},L=function(t,r){m.value=r;let S="";r.enabled?S="Sei sicuro di voler attivare l'utente <b>"+(r==null?void 0:r.email)+"</b> ?":S="Sei sicuro di voler disattivare l'utente <b>"+(r==null?void 0:r.email)+"</b> ?",b.setDialog("Cambia stato","Conferma","Annulla",S),b.setDynamicDialogVisibility(!0)},$=async function(){var r;d.value=!0;const t={user_id:m.value.id,user:{enabled:(r=m.value)==null?void 0:r.enabled}};await u.updateUser(t).then(()=>{d.value=!1,X(y,{message:"Stato aggiornato correttamente",error:!1}),w()}).catch(S=>{d.value=!1,R(y,S)})},j=function(t){return t!=null&&t.cluster?t.cluster:""};return k(h,()=>{$()}),k(c,()=>{m.value.enabled=!m.value.enabled}),{dt:F,responseUsers:f,filters:g,loading:d,totalRecords:l,lazyParams:e,matchModes:o,userRoles:a,currentUser:m,status:T,onPage:q,onSort:z,onFilter:B,showSidebar:N,loadLazyData:w,onChangeStatus:L,getRowClass:j,prettyUserRole:Z,formatPrettyDate:H,formatDataFromUnixTimestamps:Q}},components:{}};const oe={class:"user-table"},le={class:"flex justify-content-between align-items-center"},se={class:"p-input-icon-left w-full mr-3 py-2"},ne=M("i",{class:"pi pi-search"},null,-1),re={key:0},ie={key:1};function de(u,s,f,a,T,b){const h=p("InputText"),c=p("Column"),y=p("Calendar"),F=p("Dropdown"),m=p("Badge"),g=p("InputSwitch"),d=p("DataTable");return _(),V("div",oe,[n(d,{value:a.responseUsers.users,totalRecords:a.responseUsers.total,lazy:!0,paginator:!0,rows:30,filters:a.filters,"onUpdate:filters":s[1]||(s[1]=e=>a.filters=e),ref:"dt",dataKey:"id",loading:a.loading,onPage:s[2]||(s[2]=e=>a.onPage(e)),onSort:s[3]||(s[3]=e=>a.onSort(e)),onFilter:s[4]||(s[4]=e=>a.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:"",rowClass:a.getRowClass},{header:i(()=>[M("div",le,[M("span",se,[ne,n(h,{modelValue:a.filters.global.value,"onUpdate:modelValue":s[0]||(s[0]=e=>a.filters.global.value=e),placeholder:"Ricerca utente",class:"border-none w-full",onChange:a.loadLazyData},null,8,["modelValue","onChange"])])])]),empty:i(()=>[x(" Nessun utente trovato. ")]),default:i(()=>[n(c,{field:"email",header:"Email",filterMatchMode:"contains",ref:"email",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:i(({filterModel:e,filterCallback:l})=>[n(h,{type:"text",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,onKeydown:D(o=>l(),["enter"]),class:"p-column-filter",placeholder:"Filtra per email"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(c,{header:"Data di nascita",field:"birthdate",filterMatchMode:"contains",ref:"birthdate",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:i(({filterModel:e,filterCallback:l})=>[n(y,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,dateFormat:"dd/mm/yy",onKeydown:D(o=>l(),["enter"]),manualInput:!1,placeholder:"Filtra per data",onDateSelect:o=>l()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),body:i(({data:e})=>[e.birthdate?(_(),V("span",re,C(a.formatPrettyDate(e==null?void 0:e.birthdate)),1)):(_(),V("span",ie,"-"))]),_:1},512),n(c,{header:"Data creazione",field:"created_at",filterMatchMode:"contains",ref:"created_at",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:i(({filterModel:e,filterCallback:l})=>[n(y,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,dateFormat:"dd/mm/yy",onKeydown:D(o=>l(),["enter"]),manualInput:!1,placeholder:"Filtra per data",onDateSelect:o=>l()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),body:i(({data:e})=>[x(C(a.formatDataFromUnixTimestamps(e==null?void 0:e.created_at)),1)]),_:1},512),n(c,{field:"wp_id",header:"wp_id",filterMatchMode:"contains",ref:"wp_id",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:i(({data:e})=>[x(C(e.wp_id||"-"),1)]),filter:i(({filterModel:e,filterCallback:l})=>[n(h,{type:"text",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,onKeydown:D(o=>l(),["enter"]),class:"p-column-filter",placeholder:"Filtra per wp_id"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(c,{header:"Ruolo",ref:"role",field:"role",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,sortable:""},{filter:i(({filterModel:e,filterCallback:l})=>[n(F,{modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,options:a.userRoles,optionLabel:"name",optionValue:"value",onChange:o=>l(),placeholder:"Filtra per ruolo"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),body:i(({data:e})=>[e&&e.role?(_(),Y(m,{key:0,value:a.prettyUserRole(e.role),class:ee(["px-4 border-round-lg h-auto font-medium line-height-4",e.role])},null,8,["value","class"])):te("",!0)]),_:1},512),n(c,{header:"Stato",filterMatchMode:"contains",ref:"enabled",field:"enabled",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:i(({filterModel:e,filterCallback:l})=>[n(F,{modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,options:a.status,optionLabel:"name",optionValue:"value",onChange:o=>l(),placeholder:"Filtra per stato"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),body:i(({data:e})=>[n(g,{modelValue:e.enabled,"onUpdate:modelValue":l=>e.enabled=l,onChange:l=>a.onChangeStatus(l,e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},512)]),_:1},8,["value","totalRecords","filters","loading","rowClass"])])}const ue=O(ae,[["render",de]]),ce={setup(){const u=K(),s=U(()=>u.getTotalUsers),f=I();return{totalUser:s,showSidebar:function(){f.setDetailType("user",!0,"Nuovo utente",null),f.updateSidebar(!0),f.setShowDetail(!0)}}},components:{UsersTable:ue}},me={class:"flex justify-content-between align-items-center"},pe={class:""},fe={key:0},he={key:1};function ve(u,s,f,a,T,b){const h=p("UsersTable");return _(),V("div",null,[M("div",me,[M("h1",pe,[a.totalUser==1?(_(),V("span",fe," 1 Utente")):(_(),V("span",he,C(a.totalUser)+" Utenti",1))])]),n(h)])}const be=O(ce,[["render",ve]]);export{be as default};
