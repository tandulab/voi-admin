import{o as j,y as E,T as K,A as I,f as U,N as G,a as Q,B as v,C as H,g as R,p as k,U as J,D as W,s as X,_ as O,r as p,h as _,i as V,j as n,w as r,k as S,l as x,G as M,t as D,S as Y,q as Z,Q as ee}from"../index12853.js";const te={setup(){j(()=>{d.value=!0,e.value={first:0,rows:F.value.rows,sortField:null,sortOrder:null,filters:y.value},E.register("myfilter",(t,i)=>t===i),w()});const u=K(),s=I(),f=U(()=>u.responseUsers),a=U(()=>u.userRoles),C=U(()=>u.status),b=G(),h=U(()=>b.submitDialog),m=U(()=>b.cancelDialog),g=Q(),F=v(),c=v(),y=v({global:{value:null,matchMode:"like"},email:{value:"",matchMode:"eq"},created_at:{value:"",matchMode:"like"},birthdate:{value:"",matchMode:"like"},role:{value:"",matchMode:"eq"},enabled:{value:"",matchMode:"eq"},wp_id:{value:"",matchMode:"eq"}}),d=v(!0),e=v(),l=v(0),o=v([{label:"My Filter",value:"myfilter"}]);function w(){d.value=!0;let t=new Map;t=H(y,t),t.delete("location_eq"),t.delete("global"),t.set("page",e.value.page+1),t.set("per_page",e.value.rows),e.value.sortField&&(e.value.sortOrder==1?t.set("sorted_by",e.value.sortField+"_asc"):t.set("sorted_by",e.value.sortField+"_desc")),setTimeout(()=>{B(t)},Math.random()*1e3+250)}const B=async function(t){await u.fetchAllUsers(t).then(()=>{d.value=!1}).catch(i=>{d.value=!1,R(g,i)})},N=t=>{e.value=t,w()},q=t=>{e.value=t,w()},z=()=>{e.value.page=0,e.value.filters=y.value,w()},P=function(t){s.setDetailType("user",!1,"Dettaglio utente",t.id),s.updateSidebar(!0)},A=function(t,i){t.stopPropagation(),t.stopImmediatePropagation(),c.value=i;let T="Sei sicuro di voler disattivare l'utente <b>"+(i==null?void 0:i.email)+"</b> ?";b.setDialog("Cambia stato","Conferma","Annulla",T),b.setDynamicDialogVisibility(!0)},L=async function(){var i;d.value=!0;const t={user_id:c.value.id,user:{enabled:(i=c.value)==null?void 0:i.enabled}};await u.updateUser(t).then(()=>{d.value=!1,X(g,{message:"Stato aggiornato correttamente",error:!1}),w()}).catch(T=>{d.value=!1,R(g,T)})},$=function(t){return t!=null&&t.cluster?t.cluster:""};return k(h,()=>{L()}),k(m,()=>{c.value.enabled?c.value.enabled=!1:c.value.enabled=!0}),{dt:F,responseUsers:f,filters:y,loading:d,totalRecords:l,lazyParams:e,matchModes:o,userRoles:a,currentUser:c,status:C,onPage:N,onSort:q,onFilter:z,showSidebar:P,loadLazyData:w,onChangeStatus:A,getRowClass:$,prettyUserRole:J,formatDataFromUnixTimestamps:W}},components:{}};const ae={class:"user-table"},oe={class:"flex justify-content-between align-items-center"},le={class:"p-input-icon-left w-full mr-3 py-2"},se=S("i",{class:"pi pi-search"},null,-1),ne={key:0},re={key:1};function ie(u,s,f,a,C,b){const h=p("InputText"),m=p("Column"),g=p("Calendar"),F=p("Dropdown"),c=p("Badge"),y=p("InputSwitch"),d=p("DataTable");return _(),V("div",ae,[n(d,{value:a.responseUsers.users,totalRecords:a.responseUsers.total,lazy:!0,paginator:!0,rows:30,filters:a.filters,"onUpdate:filters":s[1]||(s[1]=e=>a.filters=e),ref:"dt",dataKey:"id",loading:a.loading,onPage:s[2]||(s[2]=e=>a.onPage(e)),onSort:s[3]||(s[3]=e=>a.onSort(e)),onFilter:s[4]||(s[4]=e=>a.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:"",rowClass:a.getRowClass},{header:r(()=>[S("div",oe,[S("span",le,[se,n(h,{modelValue:a.filters.global.value,"onUpdate:modelValue":s[0]||(s[0]=e=>a.filters.global.value=e),placeholder:"Ricerca utente",class:"border-none w-full",onChange:a.loadLazyData},null,8,["modelValue","onChange"])])])]),empty:r(()=>[x(" Nessun utente trovato. ")]),default:r(()=>[n(m,{field:"email",header:"Email",filterMatchMode:"contains",ref:"email",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:l})=>[n(h,{type:"text",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,onKeydown:M(o=>l(),["enter"]),class:"p-column-filter",placeholder:"Filtra per email"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(m,{header:"Data di nascita",field:"birthdate",filterMatchMode:"contains",ref:"birthdate",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:l})=>[n(g,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,dateFormat:"dd/mm/yy",onKeydown:M(o=>l(),["enter"]),manualInput:!1,placeholder:"Filtra per data",onDateSelect:o=>l()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),body:r(({data:e})=>[e.birthdate?(_(),V("span",ne,D(e==null?void 0:e.birthdate),1)):(_(),V("span",re,"-"))]),_:1},512),n(m,{header:"Data creazione",field:"created_at",filterMatchMode:"contains",ref:"created_at",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:l})=>[n(g,{inputId:"dateformat",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,dateFormat:"dd/mm/yy",onKeydown:M(o=>l(),["enter"]),manualInput:!1,placeholder:"Filtra per data",onDateSelect:o=>l()},null,8,["modelValue","onUpdate:modelValue","onKeydown","onDateSelect"])]),body:r(({data:e})=>[x(D(a.formatDataFromUnixTimestamps(e==null?void 0:e.created_at)),1)]),_:1},512),n(m,{field:"wp_id",header:"wp_id",filterMatchMode:"contains",ref:"wp_id",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:r(({data:e})=>[x(D(e.wp_id||"-"),1)]),filter:r(({filterModel:e,filterCallback:l})=>[n(h,{type:"text",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,onKeydown:M(o=>l(),["enter"]),class:"p-column-filter",placeholder:"Filtra per wp_id"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(m,{header:"Ruolo",ref:"role",field:"role",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,sortable:""},{filter:r(({filterModel:e,filterCallback:l})=>[n(F,{modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,options:a.userRoles,optionLabel:"name",optionValue:"value",onChange:o=>l(),placeholder:"Filtra per ruolo"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),body:r(({data:e})=>[e&&e.role?(_(),Y(c,{key:0,value:a.prettyUserRole(e.role),class:Z(["px-4 border-round-lg h-auto font-medium line-height-4",e.role])},null,8,["value","class"])):ee("",!0)]),_:1},512),n(m,{header:"Stato",filterMatchMode:"contains",ref:"enabled",field:"enabled",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:r(({filterModel:e,filterCallback:l})=>[n(F,{modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,options:a.status,optionLabel:"name",optionValue:"value",onChange:o=>l(),placeholder:"Filtra per stato"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),body:r(({data:e})=>[n(y,{modelValue:e.enabled,"onUpdate:modelValue":l=>e.enabled=l,onChange:l=>a.onChangeStatus(l,e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},512)]),_:1},8,["value","totalRecords","filters","loading","rowClass"])])}const de=O(te,[["render",ie]]),ue={setup(){const u=K(),s=U(()=>u.getTotalUsers),f=I();return{totalUser:s,showSidebar:function(){f.setDetailType("user",!0,"Nuovo utente",null),f.updateSidebar(!0),f.setShowDetail(!0)}}},components:{UsersTable:de}},ce={class:"flex justify-content-between align-items-center"},me={class:""},pe={key:0},fe={key:1};function he(u,s,f,a,C,b){const h=p("UsersTable");return _(),V("div",null,[S("div",ce,[S("h1",me,[a.totalUser==1?(_(),V("span",pe," 1 Utente")):(_(),V("span",fe,D(a.totalUser)+" Utenti",1))])]),n(h)])}const _e=O(ue,[["render",he]]);export{_e as default};
