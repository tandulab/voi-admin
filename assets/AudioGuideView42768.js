import{o as N,y as x,z as U,A as E,B as I,C as j,f as S,D as K,_ as O,r as y,h as n,i as r,k as a,j as i,w as f,t as h,E as ne,G as H,H as re,a as de,J as ue,g as V,K as ce,L as fe,M as P,N as L,O as R,P as q,Q as D,l as B,q as _e}from"../index42768.js";const ge={props:["filters"],setup(m,l){N(()=>{m.filters&&(_.value=Object.assign({},m.filters))});const _=x({}),t=U(),C=E(),k=I(),b=j(),v=S(()=>C.responseCategories),d=S(()=>t.allTags),F=S(()=>k.allGuides),g=S(()=>b.status);return{form:_,categories:v,tags:d,guides:F,statuses:g,prettyCategoryGroup:K,saveData:function(){},toggleCancel:function(){},resetFilter:function(){_.value=null,l.emit("onSaveFilter",_.value)}}}},me={class:"filter-component"},ve={class:"col-12 flex m-0 p-0 align-items-center justify-content-between filter-header"},pe=a("h2",{class:"m-0"},"Filtri",-1),he={class:"formgrid grid mt-4 flex flex-column px-2"},ye={class:"field"},be=a("label",{for:"category"},"Categoria",-1),xe={class:"flex align-items-center"},Se={class:"field flex flex-column"},Ae=a("label",{for:"tag"},"Tag",-1),Ce={class:"field flex flex-column"},we=a("label",{for:"guide"},"Guida",-1),ke={class:"field flex flex-column"},Ge=a("label",{for:"status"},"Stato",-1);function Fe(m,l,_,t,C,k){const b=y("Button"),v=y("Dropdown");return n(),r("div",me,[a("div",ve,[pe,a("div",null,[i(b,{label:"Annulla",text:"",rounded:"",class:"mr-3",size:"small",onClick:l[0]||(l[0]=d=>t.resetFilter())}),i(b,{label:"Applica",outlined:"",rounded:"",size:"small",onClick:l[1]||(l[1]=d=>m.$emit("onSaveFilter",t.form))})])]),a("div",he,[a("div",ye,[be,i(v,{id:"category",modelValue:t.form.category_id,"onUpdate:modelValue":l[2]||(l[2]=d=>t.form.category_id=d),options:t.categories,optionLabel:"flat_translations.it",optionGroupLabel:"group",optionGroupChildren:"items",placeholder:"",class:"w-full"},{optiongroup:f(d=>[a("div",xe,[a("div",null,h(t.prettyCategoryGroup(d.option.group)),1)])]),_:1},8,["modelValue","options"])]),a("div",Se,[Ae,i(v,{id:"tag",modelValue:t.form.tag,"onUpdate:modelValue":l[3]||(l[3]=d=>t.form.tag=d),options:t.tags,optionLabel:"flat_translations.it",placeholder:""},null,8,["modelValue","options"])]),a("div",Ce,[we,i(v,{id:"guide",modelValue:t.form.guide,"onUpdate:modelValue":l[4]||(l[4]=d=>t.form.guide=d),options:t.guides,optionLabel:"full_name",placeholder:""},null,8,["modelValue","options"])]),a("div",ke,[Ge,i(v,{id:"status",modelValue:t.form.status,"onUpdate:modelValue":l[5]||(l[5]=d=>t.form.status=d),options:t.statuses,optionLabel:"name",optionValue:"value",placeholder:""},null,8,["modelValue","options"])])])])}const Me=O(ge,[["render",Fe]]),Te={setup(){N(()=>{c.value=!0,p.value={first:0,rows:M.value.rows,sortField:null,sortOrder:null,filters:s.value},ne.register("myfilter",(o,u)=>o===u),G(),X(),Z(),Y(),ie()});const m=j(),l=H(),_=E(),t=I(),C=U(),k=re(),b=S(()=>m.status),v=S(()=>m.responseAudioGuide),d=S(()=>_.responseCategories),F=S(()=>t.allGuides),g=S(()=>C.allTags),A=de(),M=x(),z=x(),T=x(),w=x(),e=x(),s=x({global:{value:null,matchMode:"like"},name:{value:"",matchMode:"like"},category_id:{value:"",matchMode:"eq"},created_at:{value:"",matchMode:"like"},tag:{value:"",matchMode:"eq"},location:{value:"",matchMode:"eq"},guide:{value:"",matchMode:"eq"},status:{value:"",matchMode:"eq"}}),c=x(!0),p=x(),J=x(0),Q=x([{label:"My Filter",value:"myfilter"}]);function G(){var u;c.value=!0;let o=new Map;(u=s.value.global)!=null&&u.value&&o.set("name_like",s.value.global.value),o=ue(s,o),o.delete("location_eq"),o.delete("global"),o.set("page",p.value.page+1),o.set("per_page",p.value.rows),p.value.sortField&&(p.value.sortOrder==1?o.set("sorted_by",p.value.sortField+"_asc"):o.set("sorted_by",p.value.sortField+"_desc")),setTimeout(()=>{W(o)},Math.random()*1e3+250)}const W=async function(o){await m.fetchAllAudioGuides(o).then(()=>{c.value=!1}).catch(u=>{c.value=!1,V(A,u)})},X=async function(){let o=new Map;await _.fetchAllCategories(o).then(()=>{c.value=!1}).catch(u=>{c.value=!1,V(A,u)})},Y=async function(){let o=new Map;await t.fetchAllGuides(o).then(()=>{c.value=!1}).catch(u=>{c.value=!1,V(A,u)})},Z=async function(){await C.fetchAllTags().then(()=>{c.value=!1}).catch(o=>{c.value=!1,V(A,o)})},$=o=>{p.value=o,G()},ee=o=>{p.value=o,G()},te=function(o){l.setDetailType("audio_tour",!1,"Dettaglio audio itinerario",o.id),l.updateSidebar(!0)},oe=function(o){return o!=null&&o.cluster?o.cluster:""},le=o=>{T.value.toggle(o)},ae=o=>{if(e.value=0,w.value=Object.assign({},o),o)for(const[u,at]of Object.entries(o))u=="category_id"||u=="tag"||u=="guide"?s.value[u].value=o[u].id:s.value[u].value=o[u],e.value+=1;G(),T.value.hide()},se=o=>{delete w.value[o],G(),e.value-=1},ie=async function(){await k.fetchAllLanguages().catch(o=>{V(A,o)})};return{dt:M,responseAudioGuides:v,filters:s,loading:c,totalRecords:J,lazyParams:p,matchModes:Q,currentAudioGuide:z,status:b,categories:d,guides:F,tags:g,op:T,form_filter:w,num_filter:e,onPage:$,onSort:ee,showSidebar:te,loadLazyData:G,getRowClass:oe,prettyCategoryGroup:K,toggleFilters:le,prettyStatus:ce,onSaveFilter:ae,onRemove:se,formatDataFromUnixTimestamps:fe}},components:{AudioGuideFilters:Me}};const Ve={class:"user-table"},ze={class:"w-full mb-3 chip-filters"},Le={class:"flex justify-content-between align-items-center"},Re={class:"p-input-icon-left w-full mr-3"},Be={class:"flex align-items-center py-2"},De=a("i",{class:"pi pi-search"},null,-1),je={class:"filter"},Oe={class:"flex flex-column line-height-3"},Pe={class:"flex flex-column line-height-3"},qe={class:"flex flex-column line-height-3"},Ne={key:0,class:"text-right"},Ue={key:0},Ee={key:1,class:"flex flex-column"},Ie={class:"line-through"},Ke={key:1,class:"text-right"},He=a("div",{class:"flex justify-content-center w-full"},"Durata",-1),Je={class:"flex justify-content-center"},Qe={key:0},We={key:1};function Xe(m,l,_,t,C,k){const b=y("Chip"),v=y("InputText"),d=y("AudioGuideFilters"),F=y("OverlayPanel"),g=y("Column"),A=y("Badge"),M=y("Button"),z=y("DataTable"),T=P("badge"),w=P("tooltip");return n(),r("div",Ve,[a("div",ze,[(n(!0),r(L,null,R(t.form_filter,(e,s)=>{var c;return n(),r("span",{key:s},[e.full_name?(n(),q(b,{key:0,label:e.full_name,removable:"",class:"capitalize mr-2",onRemove:p=>t.onRemove(s)},null,8,["label","onRemove"])):(n(),q(b,{key:1,label:e.flat_translations?(c=e.flat_translations)==null?void 0:c.it:e,removable:"",class:"capitalize mr-2",onRemove:p=>t.onRemove(s)},null,8,["label","onRemove"]))])}),128))]),i(z,{value:t.responseAudioGuides.audio_guides,totalRecords:t.responseAudioGuides.total,lazy:!0,paginator:!0,rows:30,ref:"dt",dataKey:"id",loading:t.loading,onPage:l[4]||(l[4]=e=>t.onPage(e)),onSort:l[5]||(l[5]=e=>t.onSort(e)),removableSort:"",stripedRows:"",rowClass:t.getRowClass},{header:f(()=>[a("div",Le,[a("div",Re,[a("span",Be,[De,i(v,{modelValue:t.filters.global.value,"onUpdate:modelValue":l[0]||(l[0]=e=>t.filters.global.value=e),placeholder:"Ricerca per nome",class:"border-none w-full pl-2",onChange:t.loadLazyData},null,8,["modelValue","onChange"])])]),a("div",je,[t.num_filter?D((n(),r("i",{key:0,class:"pi pi-filter p-overlay-badge cursor-pointer",onClick:l[1]||(l[1]=(...e)=>t.toggleFilters&&t.toggleFilters(...e)),style:{"font-size":"1.2rem"}},null,512)),[[T,t.num_filter+""],[w,"Filtri",void 0,{bottom:!0}]]):D((n(),r("i",{key:1,class:"pi pi-filter p-overlay-badge cursor-pointer",onClick:l[2]||(l[2]=(...e)=>t.toggleFilters&&t.toggleFilters(...e)),style:{"font-size":"1.2rem"}},null,512)),[[w,"Filtri",void 0,{bottom:!0}]])])]),i(F,{ref:"op",class:"p-2",style:{"min-width":"24rem"},dismissable:!1},{default:f(()=>[i(d,{onOnSaveFilter:l[3]||(l[3]=e=>t.onSaveFilter(e)),filters:t.form_filter},null,8,["filters"])]),_:1},512)]),empty:f(()=>[B(" Nessun audio itinerario trovato. ")]),default:f(()=>[i(g,{field:"name",header:"Nome",ref:"name",sortable:!1},{body:f(({data:e})=>{var s,c;return[B(h(((c=(s=e==null?void 0:e.translations.it)==null?void 0:s.title)==null?void 0:c.text)||"-"),1)]}),_:1},512),i(g,{header:"Location",filterMatchMode:"contains",ref:"location",field:"location"},{body:f(({data:e})=>[B(h(e.location||"-"),1)]),_:1},512),i(g,{header:"Categoria",ref:"category",field:"category"},{body:f(({data:e})=>[a("div",Oe,[(n(!0),r(L,null,R(e.categories,s=>(n(),r("span",{key:s.id},h(s.flat_translations.it),1))),128))])]),_:1},512),i(g,{header:"Tag",ref:"tag",field:"tag"},{body:f(({data:e})=>[a("div",Pe,[(n(!0),r(L,null,R(e.tags,s=>(n(),r("span",{key:s.id},h(s.flat_translations.it),1))),128))])]),_:1},512),i(g,{header:"Lingue",filterMatchMode:"contains",ref:"location",field:"location"},{body:f(({data:e})=>[a("div",qe,[(n(!0),r(L,null,R(e.languages,s=>(n(),r("span",{key:s.id},h(s.language),1))),128))])]),_:1},512),i(g,{header:"Prezzo",ref:"price",field:"price",style:{"min-width":"90px"}},{body:f(({data:e})=>[e.price&&e.price!="0"?(n(),r("div",Ne,[e.discounted_price?(n(),r("div",Ee,[a("span",Ie,"€ "+h((e.price/100).toFixed(2)),1),a("b",null,"€ "+h((+e.discounted_price/100).toFixed(2)),1)])):(n(),r("span",Ue,"€ "+h((+e.price/100).toFixed(2)),1))])):(n(),r("div",Ke,"€ 0"))]),_:1},512),i(g,{header:"",filterMatchMode:"contains",ref:"location",field:"location"},{header:f(()=>[He]),body:f(({data:e})=>[a("div",Je,[e.duration?(n(),r("span",Qe,h(e.duration)+" min",1)):(n(),r("span",We,"-"))])]),_:1},512),i(g,{header:"Guida",ref:"guide",field:"guide"},{body:f(({data:e})=>{var s;return[B(h(((s=e.guide)==null?void 0:s.full_name)||"-"),1)]}),_:1},512),i(g,{header:"Stato",filterMatchMode:"contains",ref:"enabled",field:"enabled"},{body:f(({data:e})=>[i(A,{value:t.prettyStatus(e.status),class:_e(["px-4 border-round-lg h-auto font-medium line-height-4",e.status])},null,8,["value","class"])]),_:1},512),i(g,{header:"",style:{width:"4rem"}},{body:f(({data:e})=>[D(i(M,{type:"button",onClick:s=>t.showSidebar(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-3",icon:"pi pi-arrow-right",text:"",rounded:""},null,8,["onClick"]),[[w,"Modifica",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","loading","rowClass"])])}const Ye=O(Te,[["render",Xe]]),Ze={setup(){const m=j(),l=S(()=>m.getTotalAudioGuide),_=H();return{totalAudioGuide:l,showSidebar:function(){_.setDetailType("audio_tour",!0,"Nuovo audio itinerario",null),_.updateSidebar(!0),_.setShowDetail(!0)}}},components:{AudioGuideTable:Ye}},$e={class:"flex justify-content-between align-items-center"},et={class:""},tt={key:0},ot={key:1};function lt(m,l,_,t,C,k){const b=y("Button"),v=y("AudioGuideTable");return n(),r("div",null,[a("div",$e,[a("h1",et,[t.totalAudioGuide==1?(n(),r("span",tt," 1 Audio itinerario")):(n(),r("span",ot,h(t.totalAudioGuide)+" Audio itinerari",1))]),i(b,{label:"Aggiungi",onClick:l[0]||(l[0]=d=>t.showSidebar()),class:"mb-3",rounded:"",outlined:""})]),i(v)])}const it=O(Ze,[["render",lt]]);export{it as default};
